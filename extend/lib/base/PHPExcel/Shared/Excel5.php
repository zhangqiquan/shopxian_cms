<?php 

/**
 * 秀仙系统 shopxian_release/3.0.0
 * ============================================================================
 * * 版权所有 2017-2018 上海秀仙网络科技有限公司，并保留所有权利。
 * 网站地址: http://www.shopxian.com；
 * ----------------------------------------------------------------------------
 * 本软件只能免费使用  不允许对程序代码以任何形式任何目的再发布或者出售。
 * ============================================================================
 * 作者: 张启全 

 * 时间: 2018-03-17 23:28:45
 */       class PHPExcel_Shared_Excel5  {            public static function sizeCol($sheet, $col = 'A')      {                   $font = $sheet->getParent()->getDefaultStyle()->getFont();            $columnDimensions = $sheet->getColumnDimensions();                     if (isset($columnDimensions[$col]) and $columnDimensions[$col]->getWidth() != -1) {                           $columnDimension = $columnDimensions[$col];              $width = $columnDimension->getWidth();              $pixelWidth = PHPExcel_Shared_Drawing::cellDimensionToPixels($width, $font);          } elseif ($sheet->getDefaultColumnDimension()->getWidth() != -1) {                           $defaultColumnDimension = $sheet->getDefaultColumnDimension();              $width = $defaultColumnDimension->getWidth();              $pixelWidth = PHPExcel_Shared_Drawing::cellDimensionToPixels($width, $font);          } else {                           $pixelWidth = PHPExcel_Shared_Font::getDefaultColumnWidthByFont($font, true);          }                     if (isset($columnDimensions[$col]) and !$columnDimensions[$col]->getVisible()) {              $effectivePixelWidth = 0;          } else {              $effectivePixelWidth = $pixelWidth;          }            return $effectivePixelWidth;      }              public static function sizeRow($sheet, $row = 1)      {                   $font = $sheet->getParent()->getDefaultStyle()->getFont();            $rowDimensions = $sheet->getRowDimensions();                     if (isset($rowDimensions[$row]) and $rowDimensions[$row]->getRowHeight() != -1) {                           $rowDimension = $rowDimensions[$row];              $rowHeight = $rowDimension->getRowHeight();              $pixelRowHeight = (int) ceil(4 * $rowHeight / 3);          } elseif ($sheet->getDefaultRowDimension()->getRowHeight() != -1) {                           $defaultRowDimension = $sheet->getDefaultRowDimension();              $rowHeight = $defaultRowDimension->getRowHeight();              $pixelRowHeight = PHPExcel_Shared_Drawing::pointsToPixels($rowHeight);          } else {                           $pointRowHeight = PHPExcel_Shared_Font::getDefaultRowHeightByFont($font);              $pixelRowHeight = PHPExcel_Shared_Font::fontSizeToPixels($pointRowHeight);          }                     if (isset($rowDimensions[$row]) and !$rowDimensions[$row]->getVisible()) {              $effectivePixelRowHeight = 0;          } else {              $effectivePixelRowHeight = $pixelRowHeight;          }            return $effectivePixelRowHeight;      }              public static function getDistanceX(PHPExcel_Worksheet $sheet, $startColumn = 'A', $startOffsetX = 0, $endColumn = 'A', $endOffsetX = 0)      {          $distanceX = 0;                     $startColumnIndex = PHPExcel_Cell::columnIndexFromString($startColumn) - 1;          $endColumnIndex = PHPExcel_Cell::columnIndexFromString($endColumn) - 1;          for ($i = $startColumnIndex; $i <= $endColumnIndex; ++$i) {              $distanceX += self::sizeCol($sheet, PHPExcel_Cell::stringFromColumnIndex($i));          }                     $distanceX -= (int) floor(self::sizeCol($sheet, $startColumn) * $startOffsetX / 1024);                     $distanceX -= (int) floor(self::sizeCol($sheet, $endColumn) * (1 - $endOffsetX / 1024));            return $distanceX;      }              public static function getDistanceY(PHPExcel_Worksheet $sheet, $startRow = 1, $startOffsetY = 0, $endRow = 1, $endOffsetY = 0)      {          $distanceY = 0;                     for ($row = $startRow; $row <= $endRow; ++$row) {              $distanceY += self::sizeRow($sheet, $row);          }                     $distanceY -= (int) floor(self::sizeRow($sheet, $startRow) * $startOffsetY / 256);                     $distanceY -= (int) floor(self::sizeRow($sheet, $endRow) * (1 - $endOffsetY / 256));            return $distanceY;      }              public static function oneAnchor2twoAnchor($sheet, $coordinates, $offsetX, $offsetY, $width, $height)      {          list($column, $row) = PHPExcel_Cell::coordinateFromString($coordinates);          $col_start = PHPExcel_Cell::columnIndexFromString($column) - 1;          $row_start = $row - 1;            $x1 = $offsetX;          $y1 = $offsetY;                     $col_end    = $col_start;           $row_end    = $row_start;                      if ($x1 >= self::sizeCol($sheet, PHPExcel_Cell::stringFromColumnIndex($col_start))) {              $x1 = 0;          }          if ($y1 >= self::sizeRow($sheet, $row_start + 1)) {              $y1 = 0;          }            $width      = $width  + $x1 -1;          $height     = $height + $y1 -1;                     while ($width >= self::sizeCol($sheet, PHPExcel_Cell::stringFromColumnIndex($col_end))) {              $width -= self::sizeCol($sheet, PHPExcel_Cell::stringFromColumnIndex($col_end));              ++$col_end;          }                     while ($height >= self::sizeRow($sheet, $row_end + 1)) {              $height -= self::sizeRow($sheet, $row_end + 1);              ++$row_end;          }                              if (self::sizeCol($sheet, PHPExcel_Cell::stringFromColumnIndex($col_start)) == 0) {              return;          }          if (self::sizeCol($sheet, PHPExcel_Cell::stringFromColumnIndex($col_end))   == 0) {              return;          }          if (self::sizeRow($sheet, $row_start + 1) == 0) {              return;          }          if (self::sizeRow($sheet, $row_end + 1)   == 0) {              return;          }                     $x1 = $x1     / self::sizeCol($sheet, PHPExcel_Cell::stringFromColumnIndex($col_start))   * 1024;          $y1 = $y1     / self::sizeRow($sheet, $row_start + 1)   *  256;          $x2 = ($width + 1)  / self::sizeCol($sheet, PHPExcel_Cell::stringFromColumnIndex($col_end))     * 1024;          $y2 = ($height + 1) / self::sizeRow($sheet, $row_end + 1)     *  256;            $startCoordinates = PHPExcel_Cell::stringFromColumnIndex($col_start) . ($row_start + 1);          $endCoordinates = PHPExcel_Cell::stringFromColumnIndex($col_end) . ($row_end + 1);            $twoAnchor = array(              'startCoordinates' => $startCoordinates,              'startOffsetX' => $x1,              'startOffsetY' => $y1,              'endCoordinates' => $endCoordinates,              'endOffsetX' => $x2,              'endOffsetY' => $y2,          );            return  $twoAnchor;      }  }  